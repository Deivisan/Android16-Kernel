# =============================================================================
# Configurações adicionais para Docker/LXC/Halium
# Kernel 5.4.302 - POCO X5 5G (moonstone)
# =============================================================================
# Autor: DevSan
# Data: 2026-02-03
#
# PROPOSITO:
#   Estas configurações devem ser adicionadas ao moonstone_defconfig
#   para habilitar suporte a containers Docker/LXC e Halium.
#
# USO:
#   cd kernel-moonstone-devs
#   make ARCH=arm64 moonstone_defconfig
#   ./scripts/config --file .config --enable CONFIG_USER_NS
#   ./scripts/config --file .config --enable CONFIG_PID_NS
#   ... etc
#
#   # Ou manualmente editando .config:
#   cat ../configs/docker-lxc.config >> .config
#   make ARCH=arm64 olddefconfig
#
# NOTA:
#   Aplicar APENAS após build base 5.4.302 funcionar (Fase 1)
# =============================================================================

# =============================================================================
# NAMESPACES (Essencial para containers)
# =============================================================================
CONFIG_USER_NS=y
CONFIG_PID_NS=y
CONFIG_UTS_NS=y
CONFIG_IPC_NS=y
CONFIG_NET_NS=y
CONFIG_CGROUP_NS=y

# =============================================================================
# CGROUPS (Control groups para resource management)
# =============================================================================
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_PIDS=y
CONFIG_CGROUP_RDMA=y
CONFIG_CGROUP_PERF=y
CONFIG_CGROUP_HUGETLB=y
CONFIG_CGROUP_MISC=y
CONFIG_MEMCG=y
CONFIG_MEMCG_SWAP=y
CONFIG_MEMCG_KMEM=y

# =============================================================================
# IPC (Inter-process communication)
# =============================================================================
CONFIG_SYSVIPC=y
CONFIG_SYSVIPC_SYSCTL=y
CONFIG_POSIX_MQUEUE=y
CONFIG_POSIX_MQUEUE_SYSCTL=y

# =============================================================================
# OVERLAY FS (Docker storage driver)
# =============================================================================
CONFIG_OVERLAY_FS=y
CONFIG_OVERLAY_FS_REDIRECT_DIR=y
CONFIG_OVERLAY_FS_INDEX=y
CONFIG_OVERLAY_FS_XINO=y
CONFIG_OVERLAY_FS_METACOPY=y

# =============================================================================
# SECURITY (AppArmor para Ubuntu Touch/Halium)
# =============================================================================
CONFIG_SECURITY_APPARMOR=y
CONFIG_SECURITY_APPARMOR_DEBUG=y
CONFIG_SECURITY_APPARMOR_DEBUG_ASSERTS=y
CONFIG_SECURITY_APPARMOR_DEBUG_MESSAGES=y
CONFIG_SECURITY_APPARMOR_KUNIT_TEST=y
CONFIG_DEFAULT_SECURITY_APPARMOR=y
CONFIG_DEFAULT_SECURITY="apparmor"

# =============================================================================
# NAMESPACES ADICIONAIS
# =============================================================================
CONFIG_TIME_NS=y

# =============================================================================
# NETWORKING (para containers)
# =============================================================================
CONFIG_BRIDGE=y
CONFIG_BRIDGE_NETFILTER=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NETFILTER_XT_MATCH_ADDRTYPE=y
CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
CONFIG_NETFILTER_XT_MATCH_IPVS=y
CONFIG_NETFILTER_XT_MARK=y
CONFIG_IP_VS=y
CONFIG_IP_VS_PROTO_TCP=y
CONFIG_IP_VS_PROTO_UDP=y
CONFIG_IP_VS_RR=y
CONFIG_IP_VS_WRR=y
CONFIG_IP_VS_LC=y
CONFIG_IP_VS_LBLC=y
CONFIG_IP_VS_LBLCR=y
CONFIG_IP_VS_DH=y
CONFIG_IP_VS_SH=y
CONFIG_IP_VS_NQ=y
CONFIG_IP_VS_FTP=y
CONFIG_IP_VS_PE_SIP=y

# =============================================================================
# VIRTIO (para virtualização)
# =============================================================================
CONFIG_VIRTIO=y
CONFIG_VIRTIO_MENU=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_PCI_LEGACY=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_INPUT=y
CONFIG_VIRTIO_MMIO=y
CONFIG_VIRTIO_MMIO_CMDLINE_DEVICES=y

# =============================================================================
# ANDROID SPECIFIC (para Halium)
# =============================================================================
CONFIG_ANDROID=y
CONFIG_ANDROID_BINDER_IPC=y
CONFIG_ANDROID_BINDERFS=y
CONFIG_ANDROID_BINDER_DEVICES="binder,hwbinder,vndbinder"

# =============================================================================
# DEBUG (para desenvolvimento)
# =============================================================================
CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_FS=y
CONFIG_IKCONFIG=y
CONFIG_IKCONFIG_PROC=y

# =============================================================================
# BINDER (Android IPC - essencial para Halium)
# =============================================================================
CONFIG_ANDROID_BINDER_IPC_SELFTEST=y

# =============================================================================
# CHECKPOINT/RESTORE (para containers)
# =============================================================================
CONFIG_CHECKPOINT_RESTORE=y

# =============================================================================
# FUSE (Filesystem in Userspace)
# =============================================================================
CONFIG_FUSE_FS=y
CONFIG_CUSE=y
CONFIG_VIRTIO_FS=y

# =============================================================================
# NETWORK FILESYSTEMS (opcional, útil para containers)
# =============================================================================
CONFIG_NFS_FS=y
CONFIG_NFS_V2=y
CONFIG_NFS_V3=y
CONFIG_NFS_V4=y
CONFIG_ROOT_NFS=y
CONFIG_NFSD=y
CONFIG_NFSD_V2=y
CONFIG_NFSD_V3=y
CONFIG_NFSD_V4=y
CONFIG_CIFS=y
CONFIG_CIFS_SMB2=y
CONFIG_9P_FS=y
CONFIG_9P_FS_POSIX_ACL=y

# =============================================================================
# INOTIFY (para containers)
# =============================================================================
CONFIG_INOTIFY_USER=y

# =============================================================================
# EVENTFD/SIGNALFD/TIMERFD (para containers)
# =============================================================================
CONFIG_EVENTFD=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_EPOLL=y

# =============================================================================
# MEMCG (Memory cgroups - essencial para Docker)
# =============================================================================
CONFIG_MEMCG=y
CONFIG_MEMCG_SWAP=y
CONFIG_MEMCG_KMEM=y

# =============================================================================
# BLK_CGROUP (Block IO cgroups)
# =============================================================================
CONFIG_BLK_CGROUP=y
CONFIG_BLK_DEV_THROTTLING=y

# =============================================================================
# RT_GROUP_SCHED (Real-time group scheduling)
# =============================================================================
CONFIG_RT_GROUP_SCHED=y

# =============================================================================
# FAIR_GROUP_SCHED (Fair group scheduling)
# =============================================================================
CONFIG_FAIR_GROUP_SCHED=y
CONFIG_CFS_BANDWIDTH=y

# =============================================================================
# RT_SOFTINT (Soft interrupt accounting)
# =============================================================================
CONFIG_RT_SOFTINT=y
